# Insight Service Dashboard

## Что это
Веб-дашборд на Next.js 16 для оценки состояния банковских продуктов по обращениям колл-центра.

Проект построен как двухуровневый сценарий:
1. `/` — executive-экран: bubble matrix для быстрого приоритезационного обзора.
2. `/product-analytics` — детальная аналитика продукта (индикаторы + температурная карта).

## Основные страницы
1. `/`
- Главная матрица продуктов.
- Фильтры: `Поток`, `Период`, `Сброс`.
- Клик по пузырю открывает `/product-analytics` с авто-применением фильтров.

2. `/product-analytics`
- Детальная страница с текущей полной аналитикой.
- Инициализация фильтров: `query params > localStorage > defaults`.

3. `/showcase/*`
- Песочница/демо-графики для экспериментов.

## Быстрый запуск
```bash
pnpm install
pnpm dev
```

Проверки:
```bash
pnpm lint
pnpm build
```

## Источник данных
В текущей задаче используются синтетические события из:
- `lib/metrics-data.ts` (`generateEventStream`)

Каждое событие содержит продукт, тип диалога, тег, метрику, канал и временные поля.

## 4 ключевых тега (негатив)
1. `Технические проблемы/сбои`
2. `Запрос не решен`
3. `Отрицательный продуктовый фидбэк`
4. `Угроза ухода/отказа от продуктов банка`

## Бизнес-логика индекса здоровья
Подробно: `docs/health-index-model.md`

Коротко:
1. Считаются уникальные обращения (`caseId`), чтобы не раздувать вес повторяющихся событий.
2. Считается доля проблемных обращений (`problemRate`) и взвешенная тяжесть по тегам.
3. Добавляются поправки на объем (`volumeWeight`) и статистическую уверенность (`confidence`).
4. Итог: `riskIndex`, затем `healthIndex = 100 - riskIndex`.

## Bubble matrix на главной
Семантика визуализации:
1. По горизонтали — зона по доле проблемных обращений:
`Норма 0–5%`, `Внимание 5–30%`, `Критично 30–100%`.
2. По вертикали — продукты (каждый продукт в отдельной строке).
3. Размер пузыря — число проблемных обращений.
4. Цвет пузыря — зона по доле проблемных обращений (та же шкала 0–5/5–30/30–100).

Tooltip в графике содержит:
1. Продукт
2. Индекс здоровья
3. Проблемные обращения: `шт / %`
4. Все обращения
5. Главная причина (тег-драйвер)

## Drilldown контракт
Клик по пузырю формирует переход:
`/product-analytics?productGroup=<...>&sector=<...>&from=<YYYY-MM-DD>&to=<YYYY-MM-DD>&source=bubble`

## Ключевые файлы
1. `app/page.tsx` — главная executive-страница
2. `app/product-analytics/page.tsx` — роут детальной аналитики
3. `components/product-detailed-analytics-page.tsx` — детальная аналитика
4. `components/product-situation/product-situation-bubble-matrix.tsx` — матрица пузырей
5. `components/product-situation/product-situation-toolbar.tsx` — тулбар (режимы `home`/`executive`)
6. `lib/product-situation-analytics.ts` — расчетные формулы и агрегаты
